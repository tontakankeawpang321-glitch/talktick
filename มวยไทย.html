<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ONE Friday Fights 139 - Live Center</title>
    
    <!-- Google Fonts: Kanit -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;800&family=Sarabun:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Kanit', 'sans-serif'],
                        body: ['Sarabun', 'sans-serif'],
                    },
                    colors: {
                        muayRed: '#DC2626',
                        muayBlue: '#2563EB',
                        muayGold: '#F59E0B',
                        darkBg: '#0F172A',
                        cardBg: '#1E293B',
                        navBg: '#020617',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'typing': 'typing 2s steps(40, end)',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(100%)' },
                            '100%': { transform: 'translateY(0)' },
                        },
                        typing: {
                            'from': { width: '0' },
                            'to': { width: '100%' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #0F172A; /* darkBg */
            color: white;
            padding-bottom: 90px;
            -webkit-tap-highlight-color: transparent;
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .glass-nav {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        .app-view { display: none; animation: fadeIn 0.3s ease-out; }
        .app-view.active { display: block; }
        .nav-item.active { color: #F59E0B; }
        .nav-item.active i { stroke-width: 2.5px; }
        
        /* Updated Small Calendar Grid Style */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            text-align: center;
        }
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%; 
            font-size: 0.75rem; 
            color: #64748b;
            position: relative;
            cursor: default; 
            transition: all 0.2s;
            background-color: transparent;
            width: 32px; 
            height: 32px;
            margin: 0 auto;
        }
        .calendar-day.clickable {
            cursor: pointer;
            color: white;
            background-color: rgba(255,255,255,0.05);
        }
        .calendar-day.clickable:hover {
            background-color: rgba(255,255,255,0.1);
        }
        .calendar-day.active { 
            background-color: #F59E0B; 
            color: #000;
            font-weight: bold;
            box-shadow: 0 0 5px rgba(245, 158, 11, 0.4);
        }
        .calendar-day.today { 
            border: 2px solid #F59E0B;
            color: #F59E0B;
            font-weight: bold;
        }
        .calendar-day.active.today {
            background-color: #F59E0B;
            color: black;
            border: 2px solid #F59E0B;
        }
        .calendar-day.disabled {
            opacity: 0.3;
            pointer-events: none;
        }

        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        
        .tech-card-bg {
            background: radial-gradient(circle at center, #1E293B 0%, #0F172A 100%);
        }
        .date-badge {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Typewriter Cursor */
        .typewriter-cursor::after {
            content: '|';
            animation: blink 1s infinite;
        }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body class="antialiased selection:bg-muayGold selection:text-black">

    <!-- Top App Bar -->
    <div class="fixed top-0 w-full z-40 glass-nav border-b-0 border-b-gray-800 md:hidden h-16 flex items-center justify-between px-4 shadow-lg">
        <div class="flex items-center gap-2">
            <div class="bg-gradient-to-tr from-muayRed to-muayBlue p-1.5 rounded-lg">
                <i data-lucide="swords" class="w-5 h-5 text-white"></i>
            </div>
            <!-- Updated Title -->
            <span class="text-lg font-bold tracking-wide">มวยไทย</span>
        </div>
        <div class="flex gap-3">
            <div class="flex items-center gap-1 text-[10px] text-green-400 border border-green-900 bg-green-900/20 px-2 py-0.5 rounded-full">
                <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span>
                LIVE
            </div>
        </div>
    </div>

    <!-- Main Content Wrapper -->
    <div class="pt-20 md:pt-24 pb-4 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <!-- === VIEW 1: HOME (Schedule) === -->
        <div id="view-home" class="app-view active">
            <!-- Hero Banner -->
            <div class="mb-6">
                <div class="relative rounded-2xl overflow-hidden shadow-2xl bg-gray-800 aspect-[2/1] md:aspect-[3/1] group">
                    <div class="absolute inset-0 bg-gradient-to-r from-black via-transparent to-black opacity-80 z-10"></div>
                    <img src="https://placehold.co/1200x400/111/FFF?text=ONE+Lumpinee+139" class="w-full h-full object-cover opacity-70 group-hover:scale-105 transition duration-700">
                    <div class="absolute bottom-0 left-0 p-6 z-20 w-full">
                        <div class="flex items-center gap-2 mb-3">
                            <span class="bg-muayRed text-white text-xs font-bold px-2 py-0.5 rounded animate-pulse">ถ่ายทอดสด</span>
                            <span class="text-xs text-gray-300 flex items-center gap-1"><i data-lucide="zap" class="w-3 h-3"></i> อัพเดทเรียลไทม์</span>
                        </div>
                        <h1 class="text-2xl md:text-4xl font-bold mb-2 text-white drop-shadow-lg">ONE ลุมพินี 139</h1>
                        
                        <!-- Auto Date Display -->
                        <div class="inline-flex items-center gap-3 date-badge px-4 py-2 rounded-lg mb-2">
                            <div class="bg-muayGold text-black font-bold px-2 py-0.5 rounded text-xs" id="headerMonth">...</div>
                            <span id="headerDate" class="text-white font-mono text-sm tracking-wide">...</span>
                            <span class="text-gray-400 text-xs border-l border-gray-600 pl-3" id="headerDay">...</span>
                        </div>

                        <p class="text-gray-400 text-xs md:text-sm line-clamp-1 mt-2">วรพล vs ซอ ลิน อู | ศึกใหญ่ประจำสัปดาห์</p>
                    </div>
                </div>
            </div>

            <!-- Header + AI Update Button -->
            <div class="flex justify-between items-center mb-4 bg-gray-800/50 p-3 rounded-xl border border-gray-700/50">
                <div>
                    <h2 class="text-lg font-bold flex items-center gap-2 text-white">
                        <span class="w-1 h-5 bg-muayGold rounded-full"></span>
                        รายการแข่งขัน
                    </h2>
                    <span class="text-[10px] text-gray-400">อัปเดตล่าสุด: <span id="lastUpdate" class="text-gray-300">เมื่อสักครู่</span></span>
                </div>
                
                <!-- AI Update All Button -->
                <button onclick="updateAllSystem()" class="bg-gradient-to-r from-muayGold to-amber-600 hover:from-amber-400 hover:to-amber-700 text-black font-bold text-xs px-4 py-2 rounded-lg shadow-lg shadow-amber-900/40 flex items-center gap-2 transition active:scale-95">
                    <i data-lucide="sparkles" class="w-4 h-4"></i>
                    อัพเดทตารางจริง
                </button>
            </div>
            
            <div class="space-y-4 min-h-[200px]" id="scheduleContainer">
                <!-- Data injected via JS -->
            </div>
        </div>

        <!-- === VIEW 2: TECHNIQUES === -->
        <div id="view-techniques" class="app-view">
            <div class="flex justify-between items-center mb-4 mt-2">
                <h2 class="text-xl font-bold flex items-center gap-2">
                    <span class="w-1 h-6 bg-muayBlue rounded-full"></span>
                    คลังท่ามวยไทย (35 ท่า)
                </h2>
                <div class="text-xs text-gray-400 bg-gray-800 px-3 py-1 rounded-full border border-gray-700 font-mono" id="techProgressBadge">
                    0/35
                </div>
            </div>
            
            <!-- Search Bar -->
            <div class="relative mb-4">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <i data-lucide="search" class="w-5 h-5 text-gray-500"></i>
                </div>
                <input type="text" id="techSearch" onkeyup="searchTechniques()" 
                       class="bg-gray-800 border border-gray-700 text-white text-sm rounded-xl focus:ring-muayGold focus:border-muayGold block w-full pl-10 p-3" 
                       placeholder="ค้นหาแม่ไม้, ลูกไม้...">
            </div>

            <!-- Filter Bar -->
            <div class="flex gap-2 overflow-x-auto hide-scrollbar pb-2 mb-4">
                <button onclick="filterTechniques('all')" class="filter-btn active px-4 py-1.5 rounded-full text-xs font-bold bg-muayGold text-black whitespace-nowrap transition-all shadow-lg shadow-yellow-900/20">ทั้งหมด</button>
                <button onclick="filterTechniques('mae_mai')" class="filter-btn px-4 py-1.5 rounded-full text-xs bg-gray-800 text-gray-400 border border-gray-700 whitespace-nowrap hover:bg-gray-700 transition">แม่ไม้ (15)</button>
                <button onclick="filterTechniques('luk_mai')" class="filter-btn px-4 py-1.5 rounded-full text-xs bg-gray-800 text-gray-400 border border-gray-700 whitespace-nowrap hover:bg-gray-700 transition">ลูกไม้ (15)</button>
                <button onclick="filterTechniques('counter')" class="filter-btn px-4 py-1.5 rounded-full text-xs bg-gray-800 text-gray-400 border border-gray-700 whitespace-nowrap hover:bg-gray-700 transition">กลแก้</button>
            </div>

            <!-- New Grid Design: Name First -->
            <div id="techniquesGrid" class="grid grid-cols-2 md:grid-cols-3 gap-3">
                <!-- Cards injected via JS -->
            </div>
        </div>

        <!-- === VIEW 3: STATS (Leaderboard) === -->
        <div id="view-stats" class="app-view">
            <div class="flex justify-between items-center mb-6 mt-2">
                <h2 class="text-xl font-bold flex items-center gap-2">
                    <span class="w-1 h-6 bg-muayRed rounded-full"></span>
                    สถิติและอันดับ
                </h2>
                <span class="text-[10px] bg-gray-800 px-2 py-1 rounded text-gray-400 border border-gray-700">Season 2026</span>
            </div>

            <!-- Circle Progress -->
            <div class="bg-gray-800 p-6 rounded-2xl border border-gray-700 mb-6 flex items-center justify-between shadow-lg">
                <div>
                    <h3 class="text-gray-400 text-sm mb-1">ความเชี่ยวชาญ</h3>
                    <div class="text-3xl font-bold text-white mb-1"><span id="statsLearnedCount">0</span><span class="text-base text-gray-500">/35</span></div>
                    <p class="text-xs text-muayGold" id="statsRankText">ระดับ: มือใหม่</p>
                </div>
                <div class="relative w-20 h-20">
                    <svg class="w-full h-full transform -rotate-90">
                        <circle cx="40" cy="40" r="36" stroke="#1f2937" stroke-width="8" fill="transparent"></circle>
                        <circle id="progressCircle" cx="40" cy="40" r="36" stroke="#F59E0B" stroke-width="8" fill="transparent" stroke-dasharray="226" stroke-dashoffset="226" class="transition-all duration-1000"></circle>
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center text-xs font-bold text-white" id="progressPercent">0%</div>
                </div>
            </div>
            
            <div class="flex items-end justify-center gap-2 mb-8 px-4" id="podiumContainer"></div>
            <div id="leaderboardList" class="bg-gray-800 rounded-2xl border border-gray-700 overflow-hidden divide-y divide-gray-700/50"></div>
        </div>

        <!-- === VIEW 4: PROFILE === -->
        <div id="view-profile" class="app-view">
            <div class="bg-gradient-to-br from-gray-800 to-gray-900 p-6 rounded-2xl border border-gray-700 shadow-xl mb-6 text-center relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-muayRed via-muayGold to-muayBlue"></div>
                
                <div class="relative inline-block group cursor-pointer mb-4" onclick="document.getElementById('profileUpload').click()">
                    <div class="w-24 h-24 rounded-full p-1 bg-gradient-to-br from-muayGold to-amber-700">
                        <img id="profileImg" src="https://placehold.co/100x100/334155/FFF?text=User" class="w-full h-full rounded-full object-cover bg-gray-900 group-hover:opacity-75 transition">
                    </div>
                    <div class="absolute bottom-0 right-0 bg-gray-900 p-1.5 rounded-full border border-gray-700">
                        <i data-lucide="camera" class="w-4 h-4 text-white"></i>
                    </div>
                </div>
                <input type="file" id="profileUpload" class="hidden" accept="image/*" onchange="uploadProfileImage(this)">
                
                <!-- Editable Name -->
                <div class="flex items-center justify-center gap-2 mb-1">
                    <h2 id="profileName" contenteditable="true" onblur="saveUserName()" class="text-2xl font-bold text-white outline-none border-b border-transparent hover:border-gray-500 transition cursor-text min-w-[100px]">สมชาย รักมวยไทย</h2>
                    <i data-lucide="edit-2" class="w-4 h-4 text-gray-500 opacity-50"></i>
                </div>

                <div class="inline-flex items-center gap-1 px-3 py-1 bg-gray-800 rounded-full border border-gray-600 text-xs text-muayGold mb-4">
                    <i data-lucide="medal" class="w-3 h-3"></i>
                    <span id="profileRankDisplay">Nak Muay (นักมวยฝึกหัด)</span>
                </div>

                <div class="grid grid-cols-3 gap-2 border-t border-gray-700 pt-4">
                    <div>
                        <div class="text-lg font-bold text-white" id="statCheckinsProfile">0</div>
                        <div class="text-[10px] text-gray-400">วันฝึกซ้อม</div>
                    </div>
                    <div class="border-l border-gray-700">
                        <div class="text-lg font-bold text-muayGold" id="statStreakProfile">0</div>
                        <div class="text-[10px] text-gray-400">ต่อเนื่อง</div>
                    </div>
                    <div class="border-l border-gray-700">
                        <div class="text-lg font-bold text-blue-400" id="statLearnedProfile">0</div>
                        <div class="text-[10px] text-gray-400">ท่าที่รู้</div>
                    </div>
                </div>
            </div>

            <!-- Small Calendar (Grid) -->
            <div class="bg-gray-800 p-3 rounded-2xl border border-gray-700 mb-6 w-full max-w-sm mx-auto">
                <div class="flex justify-between items-center mb-3 px-2">
                    <span class="text-sm font-bold text-gray-300" id="currentMonthYear">...</span>
                    <div class="text-[10px] text-gray-400">แตะวันที่ <span id="todayIndicator"></span> เพื่อลงชื่อ</div>
                </div>
                <div class="grid grid-cols-7 gap-1 text-center text-[10px] text-gray-500 mb-2">
                    <div>อา</div><div>จ</div><div>อ</div><div>พ</div><div>พฤ</div><div>ศ</div><div>ส</div>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>
            
            <!-- Horizontal Action Buttons -->
            <div class="flex justify-center items-center gap-3">
                <button onclick="checkInToday()" class="flex-1 bg-muayRed/20 hover:bg-muayRed/30 border border-muayRed/50 text-white py-2 rounded-lg text-xs font-bold transition flex flex-col items-center justify-center gap-1 h-14">
                    <i data-lucide="check-circle" class="w-4 h-4 text-muayRed"></i>
                    ลงชื่อวันนี้
                </button>
                <button onclick="document.getElementById('profileUpload').click()" class="flex-1 bg-gray-700/50 hover:bg-gray-700 border border-gray-600 text-gray-300 py-2 rounded-lg text-xs font-bold transition flex flex-col items-center justify-center gap-1 h-14">
                    <i data-lucide="image" class="w-4 h-4"></i>
                    เปลี่ยนรูป
                </button>
                <button onclick="clearLocalData()" class="flex-1 bg-gray-700/50 hover:bg-red-900/30 border border-gray-600 hover:border-red-900 text-gray-300 hover:text-red-400 py-2 rounded-lg text-xs font-bold transition flex flex-col items-center justify-center gap-1 h-14">
                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                    ล้างข้อมูล
                </button>
            </div>
        </div>
    </div>

    <!-- AI Loading Overlay with PROMPT Animation -->
    <div id="aiOverlay" class="fixed inset-0 z-[70] hidden flex flex-col items-center justify-center bg-black/90 text-center px-6 transition-opacity duration-300 backdrop-blur-sm">
        <div class="relative mb-6">
            <div class="w-24 h-24 rounded-full border-4 border-muayGold border-t-transparent animate-spin"></div>
            <div class="absolute inset-0 flex items-center justify-center"><i data-lucide="cpu" class="w-8 h-8 text-white animate-pulse"></i></div>
        </div>
        <h3 id="aiStatusTitle" class="text-2xl font-bold text-white mb-4">กำลังประมวลผล...</h3>
        
        <!-- Prompt Box -->
        <div class="w-full max-w-sm bg-gray-900 border border-gray-700 rounded-lg p-3 text-left shadow-lg">
            <div class="flex items-center gap-2 mb-2 border-b border-gray-700 pb-2">
                <div class="w-2 h-2 rounded-full bg-red-500"></div>
                <div class="w-2 h-2 rounded-full bg-yellow-500"></div>
                <div class="w-2 h-2 rounded-full bg-green-500"></div>
                <span class="text-[10px] text-gray-500 ml-auto">AI Agent Terminal</span>
            </div>
            <p id="aiPromptText" class="text-xs text-green-400 font-mono leading-relaxed typewriter-cursor"></p>
        </div>
    </div>

    <!-- Modal -->
    <div id="infoModal" class="fixed inset-0 z-[60] hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-black/90 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>
        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center">
                <div class="relative transform overflow-hidden bg-gray-900 text-left shadow-2xl transition-all sm:w-full sm:max-w-lg rounded-2xl border border-gray-700">
                    <button onclick="closeModal()" class="absolute right-4 top-4 text-white bg-black/50 rounded-full p-2 z-20 hover:bg-black/80">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                    <div class="relative h-64 bg-black">
                        <img id="modalImg" src="" class="w-full h-full object-cover opacity-80">
                        <div class="absolute inset-0 bg-gradient-to-t from-gray-900 via-transparent to-transparent"></div>
                        <div class="absolute bottom-4 left-6 right-6">
                            <div id="modalTags" class="mb-2"></div>
                            <h3 id="modalTitle" class="text-3xl font-bold text-white shadow-black drop-shadow-md">Title</h3>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="bg-gray-800/50 p-4 rounded-xl mb-4 border border-gray-700/50">
                            <h4 class="text-muayGold font-bold text-sm mb-2 flex items-center gap-2"><i data-lucide="book-open" class="w-4 h-4"></i> คำอธิบาย</h4>
                            <p id="modalDesc" class="text-gray-300 text-sm leading-relaxed font-body">Description...</p>
                        </div>
                        <button onclick="playDemoVideo()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-xl mb-6 shadow-lg shadow-red-900/30 flex items-center justify-center gap-2 transition active:scale-95">
                            <i data-lucide="play-circle" class="w-5 h-5"></i> ดูวิดีโอสาธิต (Demo)
                        </button>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between text-xs mb-1.5 text-gray-400"><span>พลังทำลาย (Power)</span><span id="statPower" class="font-mono text-muayRed">0%</span></div>
                                <div class="w-full bg-gray-700 rounded-full h-1.5"><div id="barPower" class="bg-muayRed h-1.5 rounded-full shadow-[0_0_8px_rgba(220,38,38,0.5)]" style="width: 0%"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between text-xs mb-1.5 text-gray-400"><span>ความยาก (Difficulty)</span><span id="statDiff" class="font-mono text-muayBlue">0/100</span></div>
                                <div class="w-full bg-gray-700 rounded-full h-1.5"><div id="barDiff" class="bg-muayBlue h-1.5 rounded-full shadow-[0_0_8px_rgba(37,99,235,0.5)]" style="width: 0%"></div></div>
                            </div>
                        </div>
                        <div class="mt-6 flex items-center justify-center gap-2 text-green-400 bg-green-900/20 p-2 rounded-lg border border-green-900/50 text-xs">
                            <i data-lucide="check-circle" class="w-4 h-4"></i>
                            <span>บันทึกการเรียนรู้เรียบร้อยแล้ว</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Match Detail Modal -->
    <div id="matchModal" class="fixed inset-0 z-[65] hidden" aria-labelledby="match-modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-black/95 backdrop-blur-sm transition-opacity" onclick="closeMatchModal()"></div>
        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center">
                <div class="relative transform overflow-hidden bg-gray-900 text-left shadow-2xl transition-all sm:w-full sm:max-w-lg rounded-2xl border border-gray-700 w-full">
                    <button onclick="closeMatchModal()" class="absolute right-4 top-4 text-white bg-black/50 rounded-full p-2 z-20 hover:bg-black/80">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                    <div class="relative h-48 bg-black">
                        <img id="matchModalImg" src="" class="w-full h-full object-cover opacity-60">
                        <div class="absolute inset-0 bg-gradient-to-t from-gray-900 via-transparent to-transparent"></div>
                        <div class="absolute bottom-4 left-0 right-0 text-center">
                            <span id="matchModalEvent" class="bg-muayRed text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg">EVENT NAME</span>
                        </div>
                    </div>
                    <div class="p-6 pt-4">
                        <div class="flex justify-between items-end mb-6">
                            <div class="text-center w-1/2">
                                <h3 id="matchRedName" class="text-lg font-bold text-muayRed break-words">RED</h3>
                                <p class="text-xs text-gray-500">มุมแดง</p>
                            </div>
                            <div class="text-center w-10 text-xl font-bold text-gray-600 mb-2">VS</div>
                            <div class="text-center w-1/2">
                                <h3 id="matchBlueName" class="text-lg font-bold text-muayBlue break-words">BLUE</h3>
                                <p class="text-xs text-gray-500">มุมน้ำเงิน</p>
                            </div>
                        </div>
                        <div class="mb-6">
                            <div class="flex justify-between text-xs font-bold mb-1">
                                <span class="text-muayRed">Win Chance</span>
                                <span class="text-muayBlue">Win Chance</span>
                            </div>
                            <div class="relative h-6 bg-gray-800 rounded-full overflow-hidden border border-gray-700">
                                <div id="matchBarRed" class="absolute left-0 top-0 h-full bg-muayRed flex items-center justify-start pl-3 text-xs text-white font-bold transition-all duration-1000" style="width: 50%">50%</div>
                                <div id="matchBarBlue" class="absolute right-0 top-0 h-full bg-muayBlue flex items-center justify-end pr-3 text-xs text-white font-bold transition-all duration-1000" style="width: 50%">50%</div>
                            </div>
                            <p class="text-[10px] text-center text-gray-500 mt-2 flex items-center justify-center gap-1">
                                <i data-lucide="cpu" class="w-3 h-3"></i> วิเคราะห์โดย AI อิงจากสถิติที่ผ่านมา
                            </p>
                        </div>
                        <div class="bg-gray-800/50 rounded-xl p-4 border border-gray-700/50 space-y-3 mb-4">
                            <div class="flex justify-between text-sm items-center">
                                <span class="text-gray-400 flex items-center gap-2"><i data-lucide="calendar" class="w-4 h-4"></i> วันที่</span>
                                <span class="text-white font-medium" id="matchDetailDate">-</span>
                            </div>
                            <div class="flex justify-between text-sm items-center">
                                <span class="text-gray-400 flex items-center gap-2"><i data-lucide="clock" class="w-4 h-4"></i> เวลา</span>
                                <span class="text-white font-medium" id="matchDetailTime">-</span>
                            </div>
                            <div class="flex justify-between text-sm items-center">
                                <span class="text-gray-400 flex items-center gap-2"><i data-lucide="tv" class="w-4 h-4"></i> ช่องทาง</span>
                                <span class="text-muayGold font-bold" id="matchDetailChannel">-</span>
                            </div>
                        </div>
                        <button onclick="closeMatchModal()" class="w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 rounded-xl transition">
                            ปิดหน้าต่าง
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="fixed bottom-0 w-full glass-nav z-50 shadow-up pb-safe">
        <div class="grid grid-cols-4 items-center h-16">
            <button onclick="switchTab('home')" class="nav-item active flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-muayGold transition" id="nav-home">
                <i data-lucide="calendar-days" class="w-6 h-6 mb-1"></i><span class="text-[10px] font-medium">ตารางแข่ง</span>
            </button>
            <button onclick="switchTab('techniques')" class="nav-item flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-muayGold transition" id="nav-techniques">
                <i data-lucide="book-open" class="w-6 h-6 mb-1"></i><span class="text-[10px] font-medium">ท่ามวย</span>
            </button>
            <button onclick="switchTab('stats')" class="nav-item flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-muayGold transition" id="nav-stats">
                <i data-lucide="bar-chart-2" class="w-6 h-6 mb-1"></i><span class="text-[10px] font-medium">สถิติ</span>
            </button>
            <button onclick="switchTab('profile')" class="nav-item flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-muayGold transition" id="nav-profile">
                <i data-lucide="user" class="w-6 h-6 mb-1"></i><span class="text-[10px] font-medium">ฉัน</span>
            </button>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        lucide.createIcons();

        // --- CONSTANTS ---
        const KEY_USER = 'muay_user_name';
        const KEY_LOGS = 'muay_training_logs';
        const KEY_PROFILE_IMG = 'muay_profile_img';
        const KEY_LAST_UPDATE = 'muay_last_update_date_v6';
        const KEY_LEARNED_TECHS = 'muay_learned_techs';
        const KEY_MATCHES = 'muay_matches_data_v6';

        let currentMatches = [];
        let fighterStats = [ { rank: 1, name: "รถถัง", wins: 260, ko: 105, img: "https://placehold.co/50x50/1e293b/FFF?text=1" }, { rank: 2, name: "ซุปเปอร์เล็ก", wins: 190, ko: 78, img: "https://placehold.co/50x50/1e293b/FFF?text=2" }, { rank: 3, name: "ตะวันฉาย", wins: 135, ko: 60, img: "https://placehold.co/50x50/1e293b/FFF?text=3" }, { rank: 4, name: "ป้อมเพชร", wins: 110, ko: 48, img: "https://placehold.co/50x50/1e293b/FFF?text=4" }, { rank: 5, name: "ชาติพยัคฆ์", wins: 95, ko: 30, img: "https://placehold.co/50x50/1e293b/FFF?text=5" } ];
        let techniquesData = [
            // 35 items as before...
            { id: 'm1', name: "สลับฟันปลา", category: "mae_mai", desc: "การหลบหลีกอาวุธคู่ต่อสู้และเข้าวงในเพื่อโจมตี", power: 75, diff: 60, img: "https://placehold.co/400x300/1e293b/FFF?text=Salab+Fan+Pla" },
            { id: 'm2', name: "ปักษาแหวกรัง", category: "mae_mai", desc: "การปัดป้องและแหวกการ์ดเพื่อเข้าทำลายจังหวะ", power: 70, diff: 65, img: "https://placehold.co/400x300/1e293b/FFF?text=Paksa" },
            { id: 'm3', name: "ชวาซัดหอก", category: "mae_mai", desc: "การศอกคู่ใส่ลำตัวคู่ต่อสู้ เพื่อหยุดการบุก", power: 85, diff: 70, img: "https://placehold.co/400x300/1e293b/FFF?text=Chawa" },
            { id: 'm4', name: "อิเหนาแทงกริช", category: "mae_mai", desc: "การใช้ศอกแทงเข้าซี่โครงในระยะประชิด", power: 88, diff: 75, img: "https://placehold.co/400x300/1e293b/FFF?text=Inao" },
            { id: 'm5', name: "ยอเขาพระสุเมรุ", category: "mae_mai", desc: "การก้มหลบหมัดแล้วเสยหมัดขึ้นปลายคาง", power: 90, diff: 80, img: "https://placehold.co/400x300/1e293b/FFF?text=Yo+Khao" },
            { id: 'm6', name: "ตาเถรค้ำฝัก", category: "mae_mai", desc: "การปัดป้องการเตะสูงด้วยแขนและหมัด", power: 65, diff: 50, img: "https://placehold.co/400x300/1e293b/FFF?text=Ta+Then" },
            { id: 'm7', name: "มอญยันหลัก", category: "mae_mai", desc: "ถีบยอดอกหรือท้องเพื่อสกัดคู่ต่อสู้", power: 70, diff: 45, img: "https://placehold.co/400x300/1e293b/FFF?text=Mon+Yan" },
            { id: 'm8', name: "ปักลูกทอย", category: "mae_mai", desc: "การศอกกลับหลังเมื่อคู่ต่อสู้บุกเข้ามา", power: 92, diff: 85, img: "https://placehold.co/400x300/1e293b/FFF?text=Pak+Luk" },
            { id: 'm9', name: "จระเข้ฟาดหาง", category: "mae_mai", desc: "หมุนตัวเตะฟาดส้นเท้าเข้าที่คออย่างรุนแรง", power: 95, diff: 90, img: "https://placehold.co/400x300/1e293b/FFF?text=Chorake" },
            { id: 'm10', name: "หักงวงไอยรา", category: "mae_mai", desc: "การจับขาคู่ต่อสู้แล้วฟันศอกที่โคนขา", power: 85, diff: 70, img: "https://placehold.co/400x300/1e293b/FFF?text=Hak+Nguang" },
            { id: 'm11', name: "นาคาบิดหาง", category: "mae_mai", desc: "การบิดขาคู่ต่อสู้เมื่อจับได้เพื่อทำลายสมดุล", power: 80, diff: 75, img: "https://placehold.co/400x300/1e293b/FFF?text=Naka" },
            { id: 'm12', name: "วิรุฬหกกลับ", category: "mae_mai", desc: "การถีบกลับหลัง (Back kick) เพื่อโจมตี", power: 88, diff: 82, img: "https://placehold.co/400x300/1e293b/FFF?text=Wirun" },
            { id: 'm13', name: "ดับชวาลา", category: "mae_mai", desc: "การชกหมัดตรงไปที่ใบหน้าเพื่อปิดตา", power: 80, diff: 40, img: "https://placehold.co/400x300/1e293b/FFF?text=Dap+Chawala" },
            { id: 'm14', name: "ขุนยักษ์จับลิง", category: "mae_mai", desc: "การป้องกันหมัด-เตะ-ศอก-เข่า พร้อมกัน", power: 85, diff: 95, img: "https://placehold.co/400x300/1e293b/FFF?text=Khun+Yak+Jub+Ling" },
            { id: 'm15', name: "หักคอเอราวัณ", category: "mae_mai", desc: "การโน้มคอคู่ต่อสู้ลงมาเพื่อตีเข่า", power: 90, diff: 65, img: "https://placehold.co/400x300/1e293b/FFF?text=Hak+Kor" },
            
            // Look Mai (15)
            { id: 'l1', name: "เอราวัณเสยงา", category: "luk_mai", desc: "หมัดเสยปลายคางในระยะประชิด", power: 90, diff: 50, img: "https://placehold.co/400x300/1e293b/FFF?text=Erawan+Soei" },
            { id: 'l2', name: "บาทาลูบพักตร์", category: "luk_mai", desc: "การถีบเข้าที่ใบหน้าเพื่อทำลายสมาธิ", power: 75, diff: 60, img: "https://placehold.co/400x300/1e293b/FFF?text=Bata+Lup" },
            { id: 'l3', name: "ขุนยักษ์พานาง", category: "luk_mai", desc: "การกอดรัดและทุ่มคู่ต่อสู้", power: 85, diff: 80, img: "https://placehold.co/400x300/1e293b/FFF?text=Khun+Yak" },
            { id: 'l4', name: "พระรามน้าวศร", category: "luk_mai", desc: "การศอกกลับคู่ โดยการจับแขนคู่ต่อสู้ไว้", power: 88, diff: 85, img: "https://placehold.co/400x300/1e293b/FFF?text=Phra+Ram" },
            { id: 'l5', name: "ไกรสรข้ามห้วย", category: "luk_mai", desc: "การกระโดดถีบเข้าที่คอหรือใบหน้า", power: 92, diff: 90, img: "https://placehold.co/400x300/1e293b/FFF?text=Kraisorn" },
            { id: 'l6', name: "กวางเหลียวหลัง", category: "luk_mai", desc: "การเตะหรือถีบกลับหลังขณะคู่ต่อสู้เผลอ", power: 85, diff: 80, img: "https://placehold.co/400x300/1e293b/FFF?text=Kwang" },
            { id: 'l7', name: "หิรัญม้วนแผ่นดิน", category: "luk_mai", desc: "การศอกกลับหลังในลักษณะม้วนตัว", power: 95, diff: 90, img: "https://placehold.co/400x300/1e293b/FFF?text=Hiran" },
            { id: 'l8', name: "นาคมุดบาดาล", category: "luk_mai", desc: "การก้มตัวลอดใต้เท้าคู่ต่อสู้แล้วถีบขาพับ", power: 80, diff: 85, img: "https://placehold.co/400x300/1e293b/FFF?text=Nak+Mut" },
            { id: 'l9', name: "หนุมานถวายแหวน", category: "luk_mai", desc: "การชกเสยหมัดคู่เข้าที่ปลายคาง", power: 92, diff: 70, img: "https://placehold.co/400x300/1e293b/FFF?text=Hanuman" },
            { id: 'l10', name: "ญวนทอดแห", category: "luk_mai", desc: "การเตะตัดขาคู่ต่อสู้ให้เสียหลัก", power: 75, diff: 60, img: "https://placehold.co/400x300/1e293b/FFF?text=Yuan+Thot" },
            { id: 'l11', name: "ทยางค้ำเสา", category: "luk_mai", desc: "การถีบยันไปที่หน้าขาคู่ต่อสู้", power: 65, diff: 40, img: "https://placehold.co/400x300/1e293b/FFF?text=Thayae" },
            { id: 'l12', name: "หงส์ปีกหัก", category: "luk_mai", desc: "การศอกลงที่หัวไหล่หรือต้นแขน", power: 80, diff: 65, img: "https://placehold.co/400x300/1e293b/FFF?text=Hong+Pik" },
            { id: 'l13', name: "สักพวงมาลัย", category: "luk_mai", desc: "การแทงเข่าตรงสู่หน้าอกแล้วตามด้วยศอก", power: 88, diff: 75, img: "https://placehold.co/400x300/1e293b/FFF?text=Sak+Phuang" },
            { id: 'l14', name: "เถรกวาดลาน", category: "luk_mai", desc: "การเตะกวาดล่างให้คู่ต่อสู้ล้มทั้งยืน", power: 85, diff: 80, img: "https://placehold.co/400x300/1e293b/FFF?text=Then+Kwad" },
            { id: 'l15', name: "ฝานลูกบวบ", category: "luk_mai", desc: "การศอกเฉียงลงที่ใบหน้า", power: 82, diff: 55, img: "https://placehold.co/400x300/1e293b/FFF?text=Fan+Luk" },

            // Counters (5)
            { id: 'c1', name: "แก้หมัดด้วยศอก", category: "counter", desc: "ปัดหมัดแล้วสวนด้วยศอกทันที", power: 80, diff: 60, img: "https://placehold.co/400x300/1e293b/FFF?text=Counter+Elbow" },
            { id: 'c2', name: "แก้เตะด้วยถีบ", category: "counter", desc: "ใช้ลูกถีบสกัดเมื่อคู่ต่อสู้เริ่มยกขาเตะ", power: 75, diff: 55, img: "https://placehold.co/400x300/1e293b/FFF?text=Counter+Teep" },
            { id: 'c3', name: "แก้เข่าด้วยศอก", category: "counter", desc: "เมื่อคู่ต่อสู้ตีเข่า ให้ปักศอกลงที่ขา", power: 85, diff: 70, img: "https://placehold.co/400x300/1e293b/FFF?text=Counter+Knee" },
            { id: 'c4', name: "ฉากหลบสวนหมัด", category: "counter", desc: "ก้าวฉากออกข้างแล้วสวนหมัดตรง", power: 80, diff: 65, img: "https://placehold.co/400x300/1e293b/FFF?text=Side+Step" },
            { id: 'c5', name: "จับขาแล้วไถนา", category: "counter", desc: "จับขาคู่ต่อสู้แล้วดันไปข้างหน้าให้เสียหลัก", power: 70, diff: 60, img: "https://placehold.co/400x300/1e293b/FFF?text=Catch+Leg" }
        ];

        // --- WORKER CODE (AI SIMULATION) ---
        const workerCode = `
            self.onmessage = function(e) {
                const { today } = e.data;
                const startDate = new Date(today);
                const matches = [];
                
                const fighters = ["รถถัง จิตรเมืองนนท์", "ซุปเปอร์เล็ก เกียรติหมู่ 9", "ตะวันฉาย พี.เค.", "ซุปเปอร์บอน สิงห์มาวิน", "โจนาธาน แฮกเกอร์ตี", "น้องโอ๋ ฮาม่ามวยไทย", "เสกสรร อ.ขวัญเมือง", "เมืองไทย พี.เค.", "กุหลาบดำ สจ.เปี๊ยก", "สินสมุทร กลิ่นมี", "เลียม แฮร์ริสัน", "นาบิล อานาน", "เพชรจีจ้า", "สแตมป์ แฟร์เท็กซ์", "เดนิส พูริช", "จาค็อบ สมิธ", "ซ้ายดารา", "ยอดเหล็กเพชร", "พันธ์พยัคฆ์", "นิโค", "ก้องไกล", "คมเพชร", "อัลลิเซีย เฮลเลน", "แจ็คกี้ บุนตาน"];
                const thaiDaysShort = ["อา.", "จ.", "อ.", "พ.", "พฤ.", "ศ.", "ส."];
                const thaiMonthsShort = ["ม.ค.", "ก.พ.", "มี.ค.", "เม.ย.", "พ.ค.", "มิ.ย.", "ก.ค.", "ส.ค.", "ก.ย.", "ต.ค.", "พ.ย.", "ธ.ค."];
                
                const getRandom = (arr) => arr[Math.floor(Math.random() * arr.length)];
                
                let current = new Date(startDate);
                // Start from TOMORROW to generate future matches only
                current.setDate(current.getDate() + 1);
                
                let idCounter = Date.now();
                let count = 0;
                let limit = 15;

                // GENERATE 30 DAYS SCHEDULE (Starting from Jan 20, 2026)
                for(let i=0; i<30; i++) {
                    const day = current.getDay();
                    let eventName = "";
                    let channel = "";
                    let time = "";

                    if (day === 5) { // Friday
                        eventName = "ONE ลุมพินี " + (140 + Math.floor(i/7)); 
                        time = "19:30";
                        channel = "Ch7HD กด 35";
                    } else if (day === 6) { // Saturday
                        eventName = Math.random() > 0.5 ? "ONE Fight Night " + (40 + Math.floor(i/30)) : "RWS Rajadamnern";
                        time = "21:15";
                        channel = "Workpoint 23 / Prime";
                    } else if (day === 0) { // Sunday
                        eventName = "THAI FIGHT";
                        time = "18:00";
                        channel = "Ch8";
                    }

                    if (eventName) {
                        let r = getRandom(fighters);
                        let b = getRandom(fighters);
                        while(r===b) b=getRandom(fighters);
                        
                        const aiRed = Math.floor(Math.random() * 80) + 10;
                        const yearBE = current.getFullYear() + 543;
                        const dateStr = \`\${thaiDaysShort[day]} \${current.getDate()} \${thaiMonthsShort[current.getMonth()]} \${yearBE}\`;
                        
                        matches.push({
                            id: idCounter++,
                            event: eventName,
                            red: r,
                            blue: b,
                            time: time,
                            date: dateStr,
                            channel: channel,
                            ai_red: aiRed,
                            ai_blue: 100-aiRed,
                            img: "https://placehold.co/100x100/222/FFF?text=VS"
                        });
                    }
                    current.setDate(current.getDate() + 1);
                }

                setTimeout(() => {
                    self.postMessage({ matches: matches });
                }, 3000);
            };
        `;

        async function updateAllSystem() {
            const today = new Date(); // Use actual date
            const todayStr = today.toISOString().split('T')[0];
            const lastUpdate = localStorage.getItem(KEY_LAST_UPDATE);

            if (lastUpdate === todayStr) {
                alert("⚠️ คุณได้อัพเดทข้อมูลประจำวันไปแล้ว");
                return;
            }

            const overlay = document.getElementById('aiOverlay');
            const promptBox = document.getElementById('aiPromptContent');
            overlay.classList.remove('hidden');
            promptBox.innerHTML = '';
            
            const steps = [
                `> Initiating AI Protocol...`,
                `> Scanning Date: ${today.toLocaleDateString('th-TH')}...`,
                `> Connecting to Global Fight Database...`,
                `> Analyzing Fighter Statistics (Win/Loss/KO)...`,
                `> Generating Future Fight Card (30 Days)...`,
                `> Optimizing Matchups...`,
                `> DONE.`
            ];

            for (let i = 0; i < steps.length; i++) {
                await new Promise(r => setTimeout(r, 400));
                const p = document.createElement('p');
                p.innerText = steps[i];
                promptBox.appendChild(p);
            }

            const blob = new Blob([workerCode], { type: "application/javascript" });
            const worker = new Worker(URL.createObjectURL(blob));
            worker.postMessage({ today: today.toISOString() });

            worker.onmessage = function(e) {
                if (e.data.matches) {
                    currentMatches = e.data.matches;
                    localStorage.setItem(KEY_MATCHES, JSON.stringify(currentMatches));
                    renderSchedule(currentMatches);
                }
                
                const now = new Date();
                document.getElementById('lastUpdate').innerText = `${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;
                localStorage.setItem(KEY_LAST_UPDATE, todayStr);
                
                overlay.classList.add('hidden');
                worker.terminate();
            };
        }

        // --- FUNCTIONS ---
        function clearLocalData() {
            if(confirm('ล้างข้อมูลทั้งหมด?')) { localStorage.clear(); location.reload(); }
        }
        function switchTab(tabName) {
            document.querySelectorAll('.app-view').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + tabName).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(el => { el.classList.remove('text-muayGold'); el.classList.add('text-gray-400'); });
            document.getElementById('nav-' + tabName).classList.remove('text-gray-400');
            document.getElementById('nav-' + tabName).classList.add('text-muayGold');
            window.scrollTo(0, 0);
            if(tabName === 'profile') loadUserData();
        }
        function renderSchedule(data) {
            const container = document.getElementById('scheduleContainer');
            container.innerHTML = '';
            if(!data || data.length===0) { container.innerHTML='<div class="text-center text-gray-500 py-10">ไม่พบรายการแข่งขัน</div>'; return; }
            data.forEach(f => {
                container.innerHTML += `<div onclick="openMatchModal(${f.id})" class="bg-gray-800 rounded-2xl p-4 flex gap-4 items-center border border-gray-700/50 shadow-sm active:scale-[0.98] transition animate-fade-in cursor-pointer hover:border-muayGold"><img src="${f.img}" class="w-16 h-16 rounded-full object-cover border-2 border-gray-600"><div class="flex-1 min-w-0"><div class="flex justify-between items-start mb-1"><h3 class="font-bold text-white truncate text-base">${f.red} พบ ${f.blue}</h3><span class="bg-blue-900/30 text-blue-400 text-[10px] px-1.5 py-0.5 rounded border border-blue-900/50">Coming Soon</span></div><div class="text-xs text-gray-400 mb-2 flex flex-col gap-1"><span class="font-bold text-white">${f.event}</span><span class="flex items-center gap-1 text-muayGold"><i data-lucide="calendar" class="w-3 h-3"></i> ${f.date}</span><span class="flex items-center gap-1"><i data-lucide="clock" class="w-3 h-3"></i> ${f.time} • ${f.channel}</span></div></div></div>`;
            });
            lucide.createIcons();
        }
        
        function renderLeaderboard() { const list = document.getElementById('leaderboardList'); list.innerHTML = fighterStats.map(f => `<div class="px-4 py-3 flex items-center justify-between hover:bg-gray-700/30 transition"><div class="flex items-center gap-3"><span class="text-gray-500 font-mono w-4 text-center">${f.rank}</span><span class="text-sm font-bold text-white">${f.name}</span></div><div class="text-xs text-right text-gray-400">${f.wins} ชนะ</div></div>`).join(''); }
        function renderTechniques() {
            const container = document.getElementById('techniquesGrid'); container.innerHTML = '';
            const learnedIds = JSON.parse(localStorage.getItem(KEY_LEARNED_TECHS) || '[]');
            document.getElementById('techProgressBadge').innerText = `${learnedIds.length}/${techniquesData.length}`;
            techniquesData.forEach(t => {
                const opacity = learnedIds.includes(t.id) ? 'opacity-100 ring-1 ring-green-500' : 'opacity-90';
                const check = learnedIds.includes(t.id) ? '<div class="absolute top-2 right-2 bg-green-500 text-black w-4 h-4 rounded-full flex items-center justify-center"><i data-lucide="check" class="w-3 h-3"></i></div>' : '';
                container.innerHTML += `<div onclick="openModal('${t.id}')" class="tech-card-bg rounded-2xl p-4 border border-gray-700 hover:border-muayGold transition cursor-pointer flex flex-col justify-between h-32 relative group overflow-hidden ${opacity}">${check}<div class="absolute inset-0 opacity-0 group-hover:opacity-20 transition duration-500 bg-[url('${t.img}')] bg-cover bg-center z-0"></div><div class="relative z-10"><span class="text-[10px] text-muayGold font-bold uppercase tracking-wider mb-1 block">${t.category.replace('_', ' ')}</span><h4 class="font-bold text-lg text-white leading-tight">${t.name}</h4></div><div class="relative z-10 flex justify-between items-end mt-2"><div class="text-[10px] text-gray-400">Power: ${t.power}</div><i data-lucide="arrow-right-circle" class="w-5 h-5 text-gray-500 group-hover:text-muayGold transition"></i></div></div>`;
            });
            lucide.createIcons();
        }
        function openModal(id) { const t = techniquesData.find(x=>x.id===id); if(!t)return; let l=JSON.parse(localStorage.getItem(KEY_LEARNED_TECHS)||'[]'); if(!l.includes(id)){ l.push(id); localStorage.setItem(KEY_LEARNED_TECHS,JSON.stringify(l)); renderTechniques(); } document.getElementById('modalTitle').innerText=t.name; document.getElementById('modalDesc').innerText=t.desc; document.getElementById('modalImg').src=t.img; document.getElementById('infoModal').classList.remove('hidden'); }
        function closeModal() { document.getElementById('infoModal').classList.add('hidden'); }
        function playDemoVideo() { alert('Loading video...'); }
        function openMatchModal(id) { const m = currentMatches.find(x=>x.id==id); if(!m)return; document.getElementById('matchModalEvent').innerText=m.event; document.getElementById('matchRedName').innerText=m.red; document.getElementById('matchBlueName').innerText=m.blue; document.getElementById('matchDetailDate').innerText=m.date; document.getElementById('matchDetailTime').innerText=m.time; document.getElementById('matchDetailChannel').innerText=m.channel; document.getElementById('matchBarRed').style.width=m.ai_red+'%'; document.getElementById('matchBarRed').innerText=m.ai_red+'%'; document.getElementById('matchBarBlue').style.width=m.ai_blue+'%'; document.getElementById('matchBarBlue').innerText=m.ai_blue+'%'; document.getElementById('matchModal').classList.remove('hidden'); }
        function closeMatchModal() { document.getElementById('matchModal').classList.add('hidden'); }
        function loadUserData() {
            const logs = JSON.parse(localStorage.getItem(KEY_LOGS) || '[]');
            const now = new Date();
            const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
            const container = document.getElementById('calendarGrid'); container.innerHTML = '';
            
            const thaiMonths = ["มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน", "พฤษภาคม", "มิถุนายน", "กรกฎาคม", "สิงหาคม", "กันยายน", "ตุลาคม", "พฤศจิกายน", "ธันวาคม"];
            document.getElementById('currentMonthYear').innerText = `${thaiMonths[now.getMonth()]} ${now.getFullYear() + 543}`;
            document.getElementById('todayIndicator').innerText = now.getDate();

            for(let i=1; i<=daysInMonth; i++) {
                const el = document.createElement('div'); el.className = 'calendar-day'; el.innerText = i;
                const m = String(now.getMonth() + 1).padStart(2, '0');
                const d = String(i).padStart(2, '0');
                const dateStr = `${now.getFullYear()}-${m}-${d}`;
                if(i === now.getDate()) el.classList.add('today');
                if(logs.includes(dateStr)) el.classList.add('active');
                if(i === now.getDate()) { el.classList.add('clickable'); el.onclick = () => toggleCheckIn(dateStr); } else { el.classList.add('disabled'); }
                container.appendChild(el);
            }
            document.getElementById('statCheckinsProfile').innerText = logs.length;
        }
        function toggleCheckIn(d) { let l = JSON.parse(localStorage.getItem(KEY_LOGS)||'[]'); if(l.includes(d)) l=l.filter(x=>x!==d); else l.push(d); localStorage.setItem(KEY_LOGS,JSON.stringify(l)); loadUserData(); }
        function checkInToday() { const n=new Date(); toggleCheckIn(`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,'0')}-${String(n.getDate()).padStart(2,'0')}`); }
        function uploadProfileImage(input) { if(input.files && input.files[0]) { const reader = new FileReader(); reader.onload = function(e) { document.getElementById('profileImg').src = e.target.result; localStorage.setItem(KEY_PROFILE_IMG, e.target.result); }; reader.readAsDataURL(input.files[0]); } }
        function saveUserName() { localStorage.setItem(KEY_USER, document.getElementById('profileName').innerText); }

        function initData() {
            const now = new Date();
            const thaiMonths = ["มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน", "พฤษภาคม", "มิถุนายน", "กรกฎาคม", "สิงหาคม", "กันยายน", "ตุลาคม", "พฤศจิกายน", "ธันวาคม"];
            const thaiDays = ["อาทิตย์", "จันทร์", "อังคาร", "พุธ", "พฤหัสบดี", "ศุกร์", "เสาร์"];
            document.getElementById('headerMonth').innerText = "LIVE";
            document.getElementById('headerDate').innerText = `${now.getDate()} | ${now.getFullYear()+543}`;
            document.getElementById('headerDay').innerText = `วัน${thaiDays[now.getDay()]}`;

            // Use the REAL matches data for initial load
            const initialMatches = [
                { id: 13901, event: "ONE ลุมพินี 139 (คู่เอก)", red: "วรพล ลูกเจ้าพ่อโรงต้ม", blue: "ซอ ลิน อู", time: "19:30", date: "ศุกร์ 23 ม.ค. 2569", channel: "Ch7HD กด 35", ai_red: 55, ai_blue: 45, img: "https://placehold.co/600x300/111/FFF?text=ONE+Lumpinee+139" },
                { id: 3901, event: "ONE Fight Night 39 (คู่เอก)", red: "แรมโบ้เล็ก ฉ.อจลบุญ", blue: "อับดุลลา ดายาคาเอฟ", time: "08:00", date: "เสาร์ 24 ม.ค. 2569", channel: "YouTube ONE", ai_red: 60, ai_blue: 40, img: "https://placehold.co/600x300/222/FFF?text=OFN+39" },
                { id: 4001, event: "ONE Fight Night 40", red: "แจ็กกี บุนตัน", blue: "สเตลลา เฮเมตซ์เบอร์เกอร์", time: "08:00", date: "เสาร์ 14 ก.พ. 2569", channel: "YouTube ONE", ai_red: 52, ai_blue: 48, img: "https://placehold.co/600x300/333/FFF?text=OFN+40" }
            ];

            // Load Name
            const savedName = localStorage.getItem(KEY_USER);
            if(savedName) document.getElementById('profileName').innerText = savedName;

            const saved = localStorage.getItem(KEY_MATCHES);
            currentMatches = saved ? JSON.parse(saved) : initialMatches;
            renderSchedule(currentMatches);
        }

        window.onload = () => { initData(); renderTechniques(); renderLeaderboard(); lucide.createIcons(); loadUserData(); };
    </script>
</body>
</html>
